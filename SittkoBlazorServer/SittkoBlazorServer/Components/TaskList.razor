@page "/TODOList"

@using Interfaces
@using Data

@rendermode InteractiveServer

@inject ITodoListService _servise


<h3>ToDo:</h3>
<TodoListAdd OnAfterItemAdded="OnAfterAddedTaskItem" />
<button class="btn btn-primary" @onclick="AllList">Все</button>
<button class="btn btn-primary" @onclick="ListCompleted">Выполненые</button>
<button class="btn btn-primary" @onclick="ListActive">Активные</button>

<button class="btn btn-primary" @onclick="OnInitializedAsync">Обновить</button>
<div>
    <div>Шапка</div>
    <TodoList TodoItems="todoItemsFiltered" TodoListService="_servise"
              TaskListPage="taskListPage" OnAfterItemChengeInStatus="OnAfterItemChangeInStatus" />
</div>


@code {

    private List<TodoItem> todoItems { get; set; } = new();
    private List<TodoItem> todoItemsFiltered { get; set; } = new();
    private LastActiveButton lastActiveButton { get; set; }
    [Parameter]
    public TaskList taskListPage { get; set; }
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        await GetAllTodos();
        AllList();
    }

    private async Task GetAllTodos()
    {
        todoItems = await _servise.TodoListAllAsync();
    }

    private async Task OnAfterItemChangeInStatus(TodoItem val)
    {
        PageActive();
    }

    private async Task OnAfterAddedTaskItem(TodoItem val)
    {
        todoItems.Add(val);
        PageActive();
    }

    private void AllList()
    {
        todoItemsFiltered = todoItems;
        lastActiveButton = LastActiveButton.AllList;
    }

    void ListCompleted()
    {
        todoItemsFiltered = todoItems.Where(_ => _.Completed).ToList();
        lastActiveButton = LastActiveButton.ListCompleted;
    }

    void ListActive()
    {
        todoItemsFiltered = todoItems.Where(_ => !_.Completed).ToList();
        lastActiveButton = LastActiveButton.ListActive;
    }

    private void PageActive()
    {
        switch (lastActiveButton)
        {
            case LastActiveButton.AllList:
                AllList();
                break;
            case LastActiveButton.ListCompleted:
                ListCompleted();
                break;
            case LastActiveButton.ListActive:
                ListActive();
                break;
        }
    }

    enum LastActiveButton
    {
        AllList,
        ListCompleted,
        ListActive
    }
}